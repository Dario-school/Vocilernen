<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ankreuzen ‚Äì Schulhilfen</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#1a1a2e 0%,#16213e 50%,#0f3460 100%);min-height:100vh;padding:20px}
        .wrap{max-width:760px;margin:0 auto}
        .hdr{background:rgba(255,255,255,.08);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.15);border-radius:18px;padding:16px 22px;display:flex;align-items:center;gap:12px;margin-bottom:22px}
        .btn-back{background:rgba(255,255,255,.12);color:white;border:1px solid rgba(255,255,255,.25);padding:9px 16px;border-radius:18px;cursor:pointer;font-size:.88em;text-decoration:none}
        .btn-back:hover{background:rgba(255,255,255,.22)}
        .hdr-info{color:white}
        .hdr-title{font-size:1.1em;font-weight:800}
        .hdr-sub{font-size:.82em;color:rgba(255,255,255,.5)}

        .prog-bar{height:7px;background:rgba(255,255,255,.1);border-radius:4px;margin-bottom:20px;overflow:hidden}
        .prog-fill{height:100%;background:linear-gradient(90deg,#667eea,#764ba2);transition:width .3s}

        .stats{display:flex;justify-content:space-around;background:rgba(255,255,255,.07);border-radius:14px;padding:14px;margin-bottom:20px}
        .stat{text-align:center}
        .sv{font-size:1.7em;font-weight:800;color:#667eea}
        .sl{color:rgba(255,255,255,.45);font-size:.8em;margin-top:2px}

        .card{background:rgba(255,255,255,.09);border:2px solid rgba(255,255,255,.15);border-radius:20px;padding:34px;text-align:center;margin-bottom:20px;min-height:130px;display:flex;flex-direction:column;justify-content:center}
        .q-word{font-size:2.3em;font-weight:900;color:white;margin-bottom:8px}
        .q-type{color:rgba(255,255,255,.4);font-style:italic}

        .choices{display:grid;gap:12px;margin-bottom:18px}
        .choice{background:rgba(255,255,255,.07);border:2px solid rgba(255,255,255,.14);padding:16px 20px;border-radius:14px;cursor:pointer;transition:all .25s;font-size:1.05em;color:white;display:flex;align-items:center;gap:14px;text-align:left}
        .choice:hover:not(.disabled){background:rgba(255,255,255,.18);border-color:rgba(255,255,255,.35)}
        .choice.correct{border-color:#4caf50;background:rgba(76,175,80,.2);color:#a5d6a7}
        .choice.wrong{border-color:#f44336;background:rgba(244,67,54,.15);color:#ef9a9a}
        .choice.disabled{cursor:not-allowed}
        .c-letter{display:inline-flex;width:32px;height:32px;border-radius:50%;background:rgba(255,255,255,.15);align-items:center;justify-content:center;font-weight:800;font-size:.9em;flex-shrink:0}
        .choice.correct .c-letter{background:#4caf50}
        .choice.wrong .c-letter{background:#f44336}

        .feedback{padding:13px;border-radius:12px;font-size:.95em;text-align:center;display:none;margin-bottom:14px}
        .feedback.show{display:block}
        .feedback.correct{background:rgba(76,175,80,.2);color:#81c784;border:1px solid rgba(76,175,80,.4)}
        .feedback.wrong{background:rgba(244,67,54,.15);color:#ef9a9a;border:1px solid rgba(244,67,54,.35)}

        .btn-row{display:flex;justify-content:center;gap:10px}
        .btn{background:linear-gradient(135deg,#0f3460,#533483);color:white;border:none;padding:13px 26px;border-radius:22px;font-size:1em;font-weight:700;cursor:pointer;transition:transform .2s;display:none}
        .btn.show{display:inline-block}
        .btn:hover{transform:translateY(-2px)}
        .kb-hint{text-align:center;color:rgba(255,255,255,.25);font-size:.78em;margin-top:8px}

        .results{display:none;text-align:center;padding:20px}
        .results.show{display:block}
        .res-pct{font-size:4em;font-weight:900;color:#667eea;margin-bottom:16px}
        .res-info{color:rgba(255,255,255,.7);margin-bottom:28px}
        .mistakes-box{background:rgba(255,255,255,.06);border-radius:16px;padding:22px;margin-bottom:24px;text-align:left}
        .mistakes-box h3{color:white;margin-bottom:14px}
        .m-item{background:rgba(255,255,255,.06);padding:12px;border-radius:10px;border-left:4px solid #f44336;margin-bottom:8px;color:rgba(255,255,255,.85);font-size:.9em}
        .btn-sec{background:rgba(255,255,255,.1);color:white;border:1px solid rgba(255,255,255,.25);padding:12px 22px;border-radius:22px;font-size:.95em;cursor:pointer}
    </style>
</head>
<body>
<div class="wrap">
    <div class="hdr">
        <a class="btn-back" href="index.html">‚Üê Zur√ºck</a>
        <div class="hdr-info">
            <div class="hdr-title">‚òëÔ∏è Ankreuzen</div>
            <div class="hdr-sub" id="hdrSub">Laden‚Ä¶</div>
        </div>
    </div>

    <div id="quizArea">
        <div class="prog-bar"><div class="prog-fill" id="progFill"></div></div>
        <div class="stats">
            <div class="stat"><div class="sv" id="curN">1</div><div class="sl">von <span id="totN">0</span></div></div>
            <div class="stat"><div class="sv" id="corCt" style="color:#66bb6a">0</div><div class="sl">Richtig</div></div>
            <div class="stat"><div class="sv" id="wrCt" style="color:#ef5350">0</div><div class="sl">Falsch</div></div>
        </div>
        <div class="card">
            <div class="q-word" id="qWord">‚Äì</div>
            <div class="q-type" id="qType"></div>
        </div>
        <div class="choices" id="choices"></div>
        <div class="feedback" id="feedback"></div>
        <div class="btn-row">
            <button class="btn" id="nextBtn" onclick="nextQ()">Weiter ‚Üí</button>
        </div>
        <div class="kb-hint">Tastatur: A B C D w√§hlen &nbsp;|&nbsp; Enter = Weiter</div>
    </div>

    <div class="results" id="results">
        <div class="res-pct" id="resPct">‚Äì</div>
        <div class="res-info" id="resInfo">‚Äì</div>
        <div class="mistakes-box" id="mistakesBox" style="display:none">
            <h3>‚ùå Fehler:</h3>
            <div id="mistakeList"></div>
        </div>
        <div class="btn-row" style="display:flex">
            <button class="btn show" onclick="restart()">üîÑ Nochmal</button>
            <button class="btn-sec" onclick="location.href='index.html'">üè† Startseite</button>
        </div>
    </div>
</div>

<script src="vocabulary-data.js"></script>
<script>
const P=new URLSearchParams(location.search);
const subject=P.get('subject'),unit=parseInt(P.get('unit')),dir=P.get('direction')||'to-german';
let voc=[],cur=0,corr=0,wrong=0,mistakes=[],answered=false;

function init(){
    const all=getVocabularyData(subject,unit);
    if(!all||!all.length){alert('Keine Vokabeln.');history.back();return;}
    voc=[...all].sort(()=>Math.random()-.5);
    document.getElementById('hdrSub').textContent=(subject==='english'?'üá¨üáß Englisch':'üá´üá∑ Fran√ßais')+' ‚Äì Unit '+unit;
    document.getElementById('totN').textContent=voc.length;
    showQ();
}

function showQ(){
    if(cur>=voc.length){done();return;}
    const v=voc[cur];
    document.getElementById('qWord').textContent=dir==='to-german'?v.foreign:v.german;
    document.getElementById('qType').textContent=v.type||'';
    document.getElementById('curN').textContent=cur+1;
    document.getElementById('progFill').style.width=(cur/voc.length*100)+'%';
    document.getElementById('feedback').className='feedback';
    document.getElementById('nextBtn').classList.remove('show');
    answered=false;
    buildChoices(v);
}

function buildChoices(v){
    const correct=dir==='to-german'?v.german:v.foreign;
    const wrongs=voc.filter((_,i)=>i!==cur).sort(()=>Math.random()-.5).slice(0,3).map(x=>dir==='to-german'?x.german:x.foreign);
    const all=[correct,...wrongs].sort(()=>Math.random()-.5);
    const letters=['A','B','C','D'];
    const box=document.getElementById('choices');
    box.innerHTML='';
    all.forEach((opt,i)=>{
        const el=document.createElement('div');
        el.className='choice';
        el.onclick=()=>pick(i,opt===correct,correct,all);
        el.innerHTML=`<span class="c-letter">${letters[i]}</span>${opt}`;
        box.appendChild(el);
    });
}

function pick(idx,isOk,correct,all){
    if(answered)return;
    answered=true;
    const els=document.querySelectorAll('.choice');
    els.forEach(el=>{
        el.classList.add('disabled');
        if(el.textContent.slice(1).trim()===correct)el.classList.add('correct');
    });
    const fb=document.getElementById('feedback');
    if(isOk){
        els[idx].classList.add('correct');
        fb.className='feedback correct show';
        fb.textContent='‚úÖ Richtig!';
        corr++;
    }else{
        els[idx].classList.add('wrong');
        fb.className='feedback wrong show';
        fb.innerHTML=`‚ùå Falsch! Richtig: <strong>${correct}</strong>`;
        wrong++;
        mistakes.push({q:dir==='to-german'?voc[cur].foreign:voc[cur].german,correct,user:all[idx]});
    }
    document.getElementById('corCt').textContent=corr;
    document.getElementById('wrCt').textContent=wrong;
    document.getElementById('nextBtn').classList.add('show');
}

function nextQ(){ cur++; showQ(); }

function done(){
    document.getElementById('quizArea').style.display='none';
    const pct=Math.round(corr/voc.length*100);
    document.getElementById('resPct').textContent=pct+'%';
    document.getElementById('resInfo').textContent=`${corr} von ${voc.length} richtig`;
    if(mistakes.length){
        document.getElementById('mistakesBox').style.display='block';
        document.getElementById('mistakeList').innerHTML=mistakes.map(m=>`<div class="m-item"><strong>${m.q}</strong><br>Dein: ${m.user}<br>Richtig: ${m.correct}</div>`).join('');
    }
    document.getElementById('results').classList.add('show');
}

function restart(){
    voc=[...getVocabularyData(subject,unit)].sort(()=>Math.random()-.5);
    cur=0;corr=0;wrong=0;mistakes=[];
    document.getElementById('quizArea').style.display='block';
    document.getElementById('results').classList.remove('show');
    showQ();
}

document.addEventListener('keydown',e=>{
    if(document.getElementById('results').classList.contains('show'))return;
    if(['a','b','c','d'].includes(e.key.toLowerCase())){
        const i=['a','b','c','d'].indexOf(e.key.toLowerCase());
        document.querySelectorAll('.choice')[i]?.click();
    }else if(e.key==='Enter'&&answered)nextQ();
});

init();
</script>
</body>
</html>
